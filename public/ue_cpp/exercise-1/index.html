<!DOCTYPE html>
<html lang="en"  class="theme--light" >

<head>
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, viewport-fit=cover">
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://mushogenshin.com/images/apple-touch-icon-144x144.png" />
  <link rel="apple-touch-icon-precomposed" sizes="120x120" href="https://mushogenshin.com/images/apple-touch-icon-120x120.png" />
  <link rel="apple-touch-icon-precomposed" sizes="72x72" href="https://mushogenshin.com/images/apple-touch-icon-72x72.png" />
  <link rel="apple-touch-icon-precomposed" sizes="57x57" href="https://mushogenshin.com/images/apple-touch-icon-57x57.png" />
  <link rel="short icon" href="https://mushogenshin.com/images/favicon.png" type="image/x-icon" />
  <link rel="stylesheet" href="https://mushogenshin.com/style.css">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css" rel="stylesheet">
  <title>Hoan Nguyen â€¢ ðŸ”– Exercise 1: Make Template Folders</title>
  
  
  <link rel="alternate" type="application/rss+xml" title="Hoan Nguyen" href="https://mushogenshin.com/rss.xml">
  
  
  
  
</head>

<body>
  <div id="sidebar" class="animated fadeInDown">
    <div class="logo-title">
      <div class="title">
        <img src=https://mushogenshin.com/images/logo@2x.png style="width:127px;" alt="logo" />
        <h3><a href="https://mushogenshin.com/">Hoan Nguyen</a></h3>
        <div class="description">
          <p>Operating greatly in the realm between Art and Programming</p>
        </div>
      </div>
    </div>
    <ul class="social-links"><li><a href="http://artstation.com/mushogenshin" aria-label="Go to ArtStation profile page"><i class="fab fa-artstation"></i></a></li><li><a href="https://github.com/mushogenshin" aria-label="Go to Github profile page"><i class="fab fa-github"></i></a></li><li><a href="https://linkedin.com/in/hoan-trong-nguyen" aria-label="Go to Linkedin profile page"><i class="fab fa-linkedin"></i></a></li><li><a href="https://twitter.com/mushogenshin" aria-label="Go to Twitter profile page"><i class="fab fa-twitter"></i></a></li><li><a href="https://ko-fi.com/mushogenshin" aria-label="Go to Ko-fi profile page">
        <img src=https://mushogenshin.com/images/logo_Ko-fi.webp style="width:18px;filter: grayscale(100%);" alt="Ko-fi logo" />
      </a></li>
      <br/>
    </ul>
    <div class="footer">
      
      <span>My </span><a href="https://www.thingiverse.com/mushogenshin/designs">Tributes to Great Thinkers</a>
      <div class="by_zola"><a href="https://www.linkedin.com/feed/update/urn:li:activity:7231484580854206464" target="_blank">See my first video game!</a></div>
      
    </div>
  </div>
  <div id="main">
    <div class="page-top animated fadeInDown">
      <div class="nav">
        
        
        
        
        <li><a  href="https://mushogenshin.com/">Home</a></li>
        <li><a  href="https://mushogenshin.com/about/">About</a></li><li><a class="current"  href="https://mushogenshin.com/ue_cpp/">UE C++</a></li><li><a  href="https://mushogenshin.com/rigging/">Rigging</a></li><li><a  href="https://fossil-skater.mushogenshin.com">FossilSkater</a></li><li><a  href="https://mushogenshin.com/links/">Links</a></li></div>
      <div class="information">
        <div class="back_btn">
          <a onclick="window.history.go(-1)" ><i
              class="fas fa-chevron-left"></i></a>
        </div>
        
        
        
        <div class="avatar"><img src="https://mushogenshin.com/images/avatar.jpg"></div>
      </div>
    </div>
    <div class="autopagerize_page_element">
      <div class="content">
        
<article class="post animated fadeInDown">
  <h1><a href="https:&#x2F;&#x2F;mushogenshin.com&#x2F;ue_cpp&#x2F;exercise-1&#x2F;">ðŸ”– Exercise 1: Make Template Folders</a></h1>
  
  <div class="post-content"><ul>
<li><a href="https://mushogenshin.com/ue_cpp/exercise-1/#goal">Goal</a></li>
<li><a href="https://mushogenshin.com/ue_cpp/exercise-1/#Pitfall">Pitfall</a></li>
<li><a href="https://mushogenshin.com/ue_cpp/exercise-1/#suggested-solution">Suggested Solution</a></li>
<li><a href="https://mushogenshin.com/ue_cpp/exercise-1/#considerations">Considerations</a></li>
</ul>
<hr>
<h4 id="goal">Goal</h4>
<ul>
<li>Given an asset name, e.g. name of a character or a prop, the tool should automatically make a series of sub-folders for that asset. For example: given &quot;<code>Velociraptor</code>&quot; string, it must make these folders:
<ul>
<li><code>/Game/Velociraptor/Meshes</code></li>
<li><code>/Game/Velociraptor/Rigs</code></li>
<li><code>/Game/Velociraptor/Textures</code></li>
<li><code>/Game/Velociraptor/Materials</code></li>
<li><code>/Game/Velociraptor/Maps</code></li>
<li><code>/Game/Velociraptor/Sequences</code></li>
<li><code>/Game/Velociraptor/Demo/Animations</code>,</li>
</ul>
</li>
</ul>
<p>where the list of required folders is <strong>hard coded</strong> for now.</p>
<ul>
<li>The tool should take also an <em>optional</em> parent folder in case user wants to organize the resulted folders further.</li>
</ul>
<h4 id="pitfall">Pitfall</h4>
<p>At the time of my writing, GitHub Copilot will mostly suggest you to use <code>IPlatformFile</code>. With <code>IPlatformFile</code> I managed to make it work on MacOS, but not on Windows. After a couple hours troubleshooting, this is what I found.</p>
<p>ðŸ‘‰ Do not use <code>IPlatformFile</code> if you want nested folders, use <code>IFileManager</code> instead.</p>
<pre data-lang="cpp" style="background-color:#2b303b;color:#c0c5ce;" class="language-cpp "><code class="language-cpp" data-lang="cpp"><span style="color:#b48ead;">#include </span><span>&quot;</span><span style="color:#a3be8c;">HAL/PlatformFilemanager.h</span><span>&quot;
</span><span>    </span><span style="color:#65737e;">// --snip--
</span><span>    </span><span style="color:#65737e;">// DO NOT use this if you want nested folders, as it doesn&#39;t allow
</span><span>    </span><span style="color:#65737e;">// creating directories recursively, so this will fail on Windows:
</span><span>    </span><span style="color:#65737e;">// IPlatformFile&amp; PlatformFile = FPlatformFileManager::Get().GetPlatformFile();
</span><span>
</span><span>    </span><span style="color:#65737e;">// Use this instead:
</span><span>    IFileManager&amp; FileManager = IFileManager::</span><span style="color:#bf616a;">Get</span><span>();
</span><span>    </span><span style="color:#65737e;">// so that we can pass `true` to the `Tree` argument
</span><span>    </span><span style="color:#65737e;">// of this `MakeDirectory` method:
</span><span>    FileManager.</span><span style="color:#bf616a;">MakeDirectory</span><span>(*FolderPath, </span><span style="color:#d08770;">true</span><span>);
</span></code></pre>
<h3 id="suggested-solution">Suggested Solution</h3>
<p>We'll use <a href="https://docs.unrealengine.com/5.3/en-US/scripted-actions-in-unreal-engine/">Scripted Actions</a> for this exercise, saving the juicy <a href="https://docs.unrealengine.com/5.3/en-US/editor-utility-widgets-in-unreal-engine/">widgets</a> for next exercises.</p>
<h4 id="header-file">Header file</h4>
<ul>
<li>Our function doesn't mutate any data it receives, so we should mark it as <code>static</code> (1).</li>
<li>As a result, our <code>TArray&lt;FString&gt; TemplateFolders</code> where we define the list of folders to be created has to be <code>inline static const</code> (2).</li>
</ul>
<pre data-lang="cpp" style="background-color:#2b303b;color:#c0c5ce;" class="language-cpp "><code class="language-cpp" data-lang="cpp"><span style="color:#b48ead;">#pragma</span><span> once
</span><span style="color:#b48ead;">#include </span><span>&quot;</span><span style="color:#a3be8c;">CoreMinimal.h</span><span>&quot;
</span><span style="color:#b48ead;">#include </span><span>&quot;</span><span style="color:#a3be8c;">AssetActionUtility.h</span><span>&quot;
</span><span style="color:#b48ead;">#include </span><span>&quot;</span><span style="color:#a3be8c;">mkCharSetup.generated.h</span><span>&quot;
</span><span>
</span><span style="color:#bf616a;">UCLASS</span><span>()
</span><span style="color:#b48ead;">class </span><span style="color:#eff1f5;">TRUONGCONTROLRIGS_API </span><span style="color:#ebcb8b;">UmkCharSetup </span><span style="color:#eff1f5;">: </span><span style="color:#b48ead;">public </span><span style="color:#a3be8c;">UAssetActionUtility
</span><span style="color:#eff1f5;">{
</span><span style="color:#eff1f5;">	</span><span style="color:#bf616a;">GENERATED_BODY</span><span style="color:#eff1f5;">()
</span><span style="color:#b48ead;">public</span><span style="color:#eff1f5;">:
</span><span style="color:#eff1f5;">	</span><span style="color:#bf616a;">UFUNCTION</span><span style="color:#eff1f5;">(CallInEditor)
</span><span style="color:#eff1f5;">	</span><span style="color:#b48ead;">static void </span><span style="color:#8fa1b3;">MakeCharacterFolders</span><span style="color:#eff1f5;">(</span><span style="color:#b48ead;">const</span><span style="color:#eff1f5;"> FString</span><span>&amp; </span><span style="color:#bf616a;">CharacterName</span><span style="color:#eff1f5;">, </span><span style="color:#b48ead;">const</span><span style="color:#eff1f5;"> FString</span><span>&amp; </span><span style="color:#bf616a;">ParentFolder</span><span style="color:#eff1f5;">); </span><span style="color:#65737e;">// (1)
</span><span style="color:#b48ead;">private</span><span style="color:#eff1f5;">:
</span><span style="color:#eff1f5;">	</span><span style="color:#b48ead;">inline static const</span><span style="color:#eff1f5;"> TArray&lt;FString&gt; TemplateFolders </span><span>= </span><span style="color:#eff1f5;">{
</span><span style="color:#eff1f5;">		</span><span>&quot;</span><span style="color:#a3be8c;">Meshes</span><span>&quot;</span><span style="color:#eff1f5;">,
</span><span style="color:#eff1f5;">		</span><span>&quot;</span><span style="color:#a3be8c;">Rigs</span><span>&quot;</span><span style="color:#eff1f5;">,
</span><span style="color:#eff1f5;">		</span><span>&quot;</span><span style="color:#a3be8c;">Textures</span><span>&quot;</span><span style="color:#eff1f5;">,
</span><span style="color:#eff1f5;">		</span><span>&quot;</span><span style="color:#a3be8c;">Materials</span><span>&quot;</span><span style="color:#eff1f5;">,
</span><span style="color:#eff1f5;">		</span><span>&quot;</span><span style="color:#a3be8c;">Demo/Animations</span><span>&quot;</span><span style="color:#eff1f5;">,
</span><span style="color:#eff1f5;">		</span><span>&quot;</span><span style="color:#a3be8c;">Maps</span><span>&quot;</span><span style="color:#eff1f5;">,
</span><span style="color:#eff1f5;">		</span><span>&quot;</span><span style="color:#a3be8c;">Sequences</span><span>&quot;</span><span style="color:#eff1f5;">,
</span><span style="color:#eff1f5;">	}; </span><span style="color:#65737e;">// (2)
</span><span style="color:#eff1f5;">}</span><span>;
</span></code></pre>
<h4 id="cpp-file">cpp file</h4>
<ul>
<li>We'll need to include the <code>HAL/PlatformFileManager</code> for <a href="https://docs.unrealengine.com/5.3/en-US/API/Runtime/Core/HAL/FFileManagerGeneric/">filesystem-related actions</a>.</li>
<li>If user also specifies a parent folder, we concatenate it to our paths (3).</li>
<li>If the directory already exists, we <code>continue</code> to the next iteration (4).</li>
<li>The <code>FileManager.MakeDirectory</code> returns a <code>bool</code> of <a href="https://docs.unrealengine.com/5.3/en-US/API/Runtime/Core/HAL/FFileManagerGeneric/">whether the operation succeeds</a> (but unfortunately not the reason why it would fail), so we can use that to log when an error occurs (5).</li>
</ul>
<pre data-lang="cpp" style="background-color:#2b303b;color:#c0c5ce;" class="language-cpp "><code class="language-cpp" data-lang="cpp"><span style="color:#b48ead;">#include </span><span>&quot;</span><span style="color:#a3be8c;">mkCharSetup.h</span><span>&quot;
</span><span style="color:#b48ead;">#include </span><span>&quot;</span><span style="color:#a3be8c;">EditorUtilityLibrary.h</span><span>&quot;
</span><span style="color:#b48ead;">#include </span><span>&quot;</span><span style="color:#a3be8c;">HAL/PlatformFilemanager.h</span><span>&quot;
</span><span>
</span><span style="color:#b48ead;">void </span><span>UmkCharSetup::</span><span style="color:#8fa1b3;">MakeCharacterFolders</span><span>(</span><span style="color:#b48ead;">const</span><span> FString&amp; </span><span style="color:#bf616a;">CharacterName</span><span>, </span><span style="color:#b48ead;">const</span><span> FString&amp; </span><span style="color:#bf616a;">ParentFolder</span><span>)
</span><span>{
</span><span>	IFileManager&amp; FileManager = IFileManager::</span><span style="color:#bf616a;">Get</span><span>();
</span><span>	</span><span style="color:#65737e;">// Construct the full path to the /Game directory
</span><span>	</span><span style="color:#b48ead;">const</span><span> FString ContentDir = FPaths::</span><span style="color:#bf616a;">ProjectContentDir</span><span>();
</span><span>
</span><span>	</span><span style="color:#b48ead;">for </span><span>(</span><span style="color:#b48ead;">const</span><span> FString&amp; Folder : TemplateFolders)
</span><span>	{
</span><span>		FString FolderPath;
</span><span>		</span><span style="color:#b48ead;">if </span><span>(ParentFolder.</span><span style="color:#bf616a;">IsEmpty</span><span>()) </span><span style="color:#65737e;">// (3)
</span><span>		{
</span><span>			FolderPath = FPaths::</span><span style="color:#bf616a;">Combine</span><span>(ContentDir, CharacterName, Folder);
</span><span>		}
</span><span>		</span><span style="color:#b48ead;">else
</span><span>		{
</span><span>			FolderPath = FPaths::</span><span style="color:#bf616a;">Combine</span><span>(ContentDir, ParentFolder, CharacterName, Folder);
</span><span>		};
</span><span>
</span><span>		</span><span style="color:#b48ead;">if </span><span>(FileManager.</span><span style="color:#bf616a;">DirectoryExists</span><span>(*FolderPath))
</span><span>		{
</span><span>			</span><span style="color:#b48ead;">continue</span><span>; </span><span style="color:#65737e;">// (4)
</span><span>		}
</span><span>
</span><span>		</span><span style="color:#bf616a;">UE_LOG</span><span>(LogHAL, Display, </span><span style="color:#bf616a;">TEXT</span><span>(&quot;</span><span style="color:#a3be8c;">Attempting to make directory: </span><span style="color:#d08770;">%s</span><span>&quot;), *FolderPath);
</span><span>		</span><span style="color:#b48ead;">if </span><span>(!FileManager.</span><span style="color:#bf616a;">MakeDirectory</span><span>(*FolderPath, </span><span style="color:#d08770;">true</span><span>)) </span><span style="color:#65737e;">// (5)
</span><span>		{
</span><span>			</span><span style="color:#bf616a;">UE_LOG</span><span>(LogHAL, Warning, </span><span style="color:#bf616a;">TEXT</span><span>(&quot;</span><span style="color:#a3be8c;">Failed to create directory at path: </span><span style="color:#d08770;">%s</span><span>&quot;), *FolderPath);
</span><span>		}
</span><span>	}
</span><span>}
</span></code></pre>
<h4 id="considerations">Considerations</h4>
<p>Since this is a <a href="https://docs.unrealengine.com/5.3/en-US/scripted-actions-in-unreal-engine/">scripted asset action</a>, we have to select <em>some</em> asset to see the our function as an item in the context menu, which is rather inconvenient. We'll improve this once we learn about Unreal widgets.</p>
</div>
  <div class="post-footer">
    <div class="meta">
      <div class="info">
        
        <i class="far fa-sun"></i><span class="date">2023-03-03</span>
        
        
        <i class="fas fa-tags"></i>
        
        <a class="tag" href="https://mushogenshin.com/tags/unreal">&nbsp;unreal</a>
        
        <a class="tag" href="https://mushogenshin.com/tags/c++">&nbsp;c++</a>
        
        
      </div>
    </div>
  </div>
</article>
<div class="share">
  <div class="twitter">
    <a class="fab fa-twitter"
      href="http://twitter.com/share?text=ðŸ”– Exercise 1: Make Template Folders&url=https:&#x2F;&#x2F;mushogenshin.com&#x2F;ue_cpp&#x2F;exercise-1&#x2F;&hashtags=unreal,c++"></a>
  </div>
</div>










      </div>
    </div>
  </div>
  
  <script>
    function showLanguages() {
      let currentDisplay = document.getElementById("languages").style.display;
      if (currentDisplay == 'none') {
        document.getElementById("languages").style.display = 'block';
      } else {
        document.getElementById("languages").style.display = 'none';
      }
    }
  </script>
</body>

</html>
